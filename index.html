<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="Style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <title>Pixels</title>
    </head>

    <body>
        <div id="header">

            <div class="component">
                <div id="color1" class="component">
                    <form class="" action="index.html" method="post">
                        <input id="color1_text" type="text" value="#ffe303" maxlength="7" readonly> <!--temp readonly-->
                    </form>
                </div>
            </div>
            <div id="night_toggle" class="component" onclick="toggle_night()">
                <div id="sun" class="icon"></div>
                <div id="moon" class="icon"></div>
            </div>
            <div class="component">
                <div id="color2" class="component">
                    <form>
                        <input id="color2_text" type="text" value="#ffe303" maxlength="7" readonly> <!--temp readonly-->
                    </form>
                </div>
            </div>
        </div>

        <div id="background">
            <span id="output"></span>
        </div>
    </body>

    <script type="text/javascript">
        //Update alert
        alert("Update v1.1:\nYou can now use the space bar to change the colours of the cubes!\nAlso try clicking the sun icon ;)");

        function random(cap) {
            return Math.floor(Math.random()*cap);
        }

        var num_of_cubes = 140;
        var cube_color1 = random(360); //hue of the cubes
        var cube_color2 = random(360); //hue of the cubes

        var max_width = 150;
        var max_height = 150;
        var min_width = 60;
        var min_height = 60;

        var max_x = document.documentElement.clientWidth - 60; //30 is added later to create a padding effect (same for the y with 15 being added)
        var max_y = Math.floor(document.documentElement.clientHeight * 0.86) - 30; //accounting for the header

        var cubes = new Array(num_of_cubes);

        var plane = document.getElementById('background');
        for (var i = 0; i < cubes.length; i++) {
            var cube = new Object();
            cube.width = min_width + random(max_width - min_width);
            cube.height = min_height + random(max_height - min_height);
            cube.x = random(max_x - cube.width) + 30;
            cube.y = random((max_y - cube.height)) + Math.floor(document.documentElement.clientHeight * 0.14) + 15;

            cube.cp_x = cube.x + Math.round(cube.width / 2);
            cube.cp_y = cube.y + Math.round(cube.height / 2);

            cube.div = document.createElement("DIV");
            cube.div.className = "cube";
            cube.div.id = i;
            plane.appendChild(cube.div);

            var div = $('.cube#' + i);

            div.css("width", cube.width + "px");
            div.css("height", cube.height + "px");
            div.css("left", cube.x + "px");
            div.css("top", cube.y + "px");

            if (i < num_of_cubes / 4) {
                cube.color = cube_color1;
            } else if (i < num_of_cubes / 2) {
                cube.color = cube_color2;
            } else if (i < num_of_cubes - (num_of_cubes / 4)) {
                cube.color = cube_color1;
            } else {
                cube.color = cube_color2;
            }

            cube.brightness = 50 + random(25);
            div.css("background-color", "hsl(" + cube.color + ", 0%, " + cube.brightness + "%)");

            cubes[i] = cube;
        }

        (function() {
            "use strict";

            document.onmousemove = handleMouseMove;
            function handleMouseMove(event) {
                var dot, eventDoc, doc, body, pageX, pageY;

                event = event || window.event; // IE-ism

                    // If pageX/Y aren't available and clientX/Y
                    // are, calculate pageX/Y - logic taken from jQuery
                    // Calculate pageX/Y if missing and clientX/Y available
                if (event.pageX == null && event.clientX != null) {
                    eventDoc = (event.target && event.target.ownerDocument) || document;
                    doc = eventDoc.documentElement;
                    body = eventDoc.body;

                    event.pageX = event.clientX +
                        (doc && doc.scrollLeft || body && body.scrollLeft || 0) -
                        (doc && doc.clientLeft || body && body.clientLeft || 0);
                    event.pageY = event.clientY +
                        (doc && doc.scrollTop  || body && body.scrollTop  || 0) -
                        (doc && doc.clientTop  || body && body.clientTop  || 0 );
            }

            //Script:
            for (var i = 0; i < cubes.length; i++) {
                var x_dist = cubes[i].cp_x - Math.round(event.pageX);
                var y_dist = cubes[i].cp_y - Math.round(event.pageY);

                x_dist = x_dist * x_dist;
                y_dist = y_dist * y_dist;

                var distance = Math.round(Math.sqrt(x_dist + y_dist));

                if (distance <= 200) {
                    var sat = 200 + (distance * -1);
                    if (sat > 100) sat = 100;
                    $(".cube#" + i).css("background-color", "hsl(" + cubes[i].color + ", " + sat + "%, " + (cubes[i].brightness + 10) + "%)");
                } else {
                    $(".cube#" + i).css("background-color", "hsl(" + cubes[i].color + ", 0%, " + cubes[i].brightness + "%)");
                }
            }
          }
        })();

        $('#color1').css("background-color", "hsl(" + cube_color2 + ", 100%, 60%)");
        $('#color2').css("background-color", "hsl(" + cube_color1 + ", 100%, 60%)");

        function hslToHex(h, s, l) {
          h /= 360;
          s /= 100;
          l /= 100;
          let r, g, b;
          if (s === 0) {
            r = g = b = l; // achromatic
          } else {
            const hue2rgb = (p, q, t) => {
              if (t < 0) t += 1;
              if (t > 1) t -= 1;
              if (t < 1 / 6) return p + (q - p) * 6 * t;
              if (t < 1 / 2) return q;
              if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
              return p;
            };
            const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            const p = 2 * l - q;
            r = hue2rgb(p, q, h + 1 / 3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1 / 3);
          }
          const toHex = x => {
            const hex = Math.round(x * 255).toString(16);
            return hex.length === 1 ? '0' + hex : hex;
          };
          return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
        }

        document.getElementById('color1_text').value = hslToHex(cube_color2, 100, 60);
        document.getElementById('color2_text').value = hslToHex(cube_color1, 100, 60);


        /*
        //Has promise but the average is not acurate with vastly different colors
        //also the average is far more likely to be within the middle of the spectrum and thus dark mode is more common
        var night;
        var avg_color = (cube_color1 + cube_color2) / 2;
        if (avg_color <= 90 || avg_color > 270) {
            night = true; //inverse
        } else {night = false}

        //requires: toggle_night(); at the end of the script
        */

        var night = false;
        function toggle_night() {
            if (!night) {
                $('#sun').css("display", "none");
                $('#moon').css("display", "block");
                $('#night_toggle').css("background-color", "#2d3436");
                $('#header').css("background-color", "#2d3436");
                $('#background').css("background-color", "#2d3436");
                night = true;
            } else {
                $('#moon').css("display", "none");
                $('#sun').css("display", "block");
                $('#night_toggle').css("background-color", "#FBFAF8");
                $('#header').css("background-color", "#FBFAF8");
                $('#background').css("background-color", "#FBFAF8");
                night = false;
            }
        }

        function changeColors() {
            for (var i = 0; i < num_of_cubes; i++) {
                if (i < num_of_cubes / 4) {
                    cubes[i].color = cube_color1;
                } else if (i < num_of_cubes / 2) {
                    cubes[i].color = cube_color2;
                } else if (i < num_of_cubes - (num_of_cubes / 4)) {
                    cubes[i].color = cube_color1;
                } else {
                    cubes[i].color = cube_color2;
                }
            }

            $('#color1').css("background-color", "hsl(" + cube_color2 + ", 100%, 60%)");
            $('#color2').css("background-color", "hsl(" + cube_color1 + ", 100%, 60%)");

            document.getElementById('color1_text').value = hslToHex(cube_color2, 100, 60);
            document.getElementById('color2_text').value = hslToHex(cube_color1, 100, 60);
        }

        document.onkeypress = function (e) {
            e = e || window.event;
            if (e.keyCode == 32) {
                cube_color1 = random(360);
                cube_color2 = random(360);
                changeColors();
            }
        };
    </script>
</html>
